"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[2212],{42212:(e,r,o)=>{o.d(r,{O:()=>T});var n=o(41506),a=o.n(n),s=(o(47010),o(31085)),u=o(20090),t=o(57361),l=o(75205),d=o(58912),i=o(15028),c=o(14041),v=o(8378),p=o(53649);var b=o(87309),g=(o(47748),o(48227)),y=o(57333),m=o(50060);var I=o(15387),E=o(8794),h=(o(81045),o(30163),o(47214)),P=o(1911);var C=o(12164),S=o(70112),U=o(78566),k=(o(97107),o(64727),o(66957));const f="useContextualStoreCallbacks",x=(0,c.memo)((e=>{const{availabilityId:r,productId:o,productPrograms:n,scenario:u,sessionTelemetryProps:t,skuId:d,source:v,type:p,xgpuEntitlement:h,useHostedStore:P,onOpenUrl:x,onSuccess:T,onCancel:L,onClose:M,onError:A}=e,X=((e,r)=>{const{deviceInformation:{isFireOS:o,isMobile:n,isTizen:a,isWebOS:s,isSupportedTVBrowser:u}}=(0,y.A)();return(0,c.useMemo)((()=>{let t=n?m.Uy.XboxComMobile:m.Uy.XboxCom;const l=null===e||void 0===e?void 0:e.includes(m.Ph.BYOG),d=null===e||void 0===e?void 0:e.includes(m.Ph.GPULTIMATE),i=l&&!d,c=!0===(0,g.OR)();return i?(n?t=m.Uy.XboxComByogMobile:u?a&&c?t=m.Uy.SamsungThirdPartyByog:a?t=m.Uy.SamsungByog:o?t=m.Uy.AmazonByog:s&&(t=m.Uy.LGByog):t=m.Uy.XboxComByog,t):(u&&(a?t=c?null!==r&&void 0!==r&&r.HasPurchased?m.Uy.SamsungThirdPartyXgpuSubscriber:null!==r&&void 0!==r&&r.IsTrial?m.Uy.SamsungThirdPartyXgpuTrialSubscriber:m.Uy.SamsungThirdPartyXgpuNonSubscriber:null!==r&&void 0!==r&&r.HasPurchased?m.Uy.SamsungXgpuSubscriber:null!==r&&void 0!==r&&r.IsTrial?m.Uy.SamsungXgpuTrialSubscriber:m.Uy.SamsungXgpuNonSubscriber:o?t=null!==r&&void 0!==r&&r.HasPurchased?m.Uy.AmazonXgpuSubscriber:null!==r&&void 0!==r&&r.IsTrial?m.Uy.AmazonXgpuTrialSubscriber:m.Uy.AmazonXgpuNonSubscriber:s&&(t=null!==r&&void 0!==r&&r.HasPurchased?m.Uy.LGXgpuSubscriber:null!==r&&void 0!==r&&r.IsTrial?m.Uy.LGXgpuTrialSubscriber:m.Uy.LGXgpuNonSubscriber)),t)}),[o,n,u,a,s,e,null===r||void 0===r?void 0:r.HasPurchased,null===r||void 0===r?void 0:r.IsTrial])})(n,h),O=(0,C.Z)(),_=(0,U.$)(),w=(0,U.p6)(),{telemetryProvider:N}=(0,y.A)(),B=(0,I.G_)(b.H.EnableContextualStoreVNext),R=(0,c.useCallback)((e=>{e&&e!==_.page&&(0,U.Ck)(w,e)}),[w,_.page]),{onMessage:D,onResult:H,onLoaded:Q}=(e=>{let{onPageChange:r,onLoad:o,onSuccess:n,onError:s,onCancel:u,onClose:t,handleOpenUrl:d}=e;const{telemetryProvider:i}=(0,y.A)(),v=(0,c.useMemo)((()=>new k.Logger(f)),[]),p=(0,U.$)(),b=(0,c.useRef)(!1),g=(0,c.useRef)(!1);return(0,c.useMemo)((()=>({onLoaded:()=>{!0!==g.current&&(null===o||void 0===o||o(),g.current=!0,v.info(`Purchase loaded for ${p.storeId}`))},onResult:e=>{if(v.info(f,"Response from contextual store",e),!0===b.current)return v.warn(f,`Duplicate purchase result detected, returning: ${JSON.stringify(e)}`),void(null===t||void 0===t||t());const{status:r,productId:o,skuId:d,availabilityId:c,orderId:g,error:y,xboxCardUsedForPurchase:m}=e,I=null!==o&&void 0!==o?o:"unknown";switch(r){case l.Qo6.Purchased:i.trackEvent(a()(a()({name:S.b.PurchaseCompleted},p),{},{productId:I,skuId:d,availabilityId:c,status:r,orderId:null!==g&&void 0!==g?g:"",xboxCardUsedForPurchase:m})),null===n||void 0===n||n(e),null===t||void 0===t||t();break;case l.Qo6.PurchaseError:case l.Qo6.ServiceError:throw i.trackEvent(a()(a()({name:S.b.PurchaseError},p),{},{productId:I,skuId:d,availabilityId:c,status:r,error:JSON.stringify(y)})),null===s||void 0===s||s(null!==y&&void 0!==y?y:new Error("Contextual store purchase error"),e),null===t||void 0===t||t(),y;case l.Qo6.Canceled:i.trackEvent(a()(a()({name:S.b.PurchaseCancelled},p),{},{productId:I,skuId:d,availabilityId:c,status:r})),null===u||void 0===u||u(),null===t||void 0===t||t();break;case l.Qo6.AlreadyPurchased:i.trackEvent(a()(a()({name:S.b.PurchaseCompleted},p),{},{productId:I,skuId:d,availabilityId:c,status:r,orderId:null!==g&&void 0!==g?g:""})),null===s||void 0===s||s(null!==y&&void 0!==y?y:new Error(`Product: ${o}/${d}/${c} already purchased`),e),null===t||void 0===t||t();break;default:i.trackEvent(a()(a()({name:S.b.PurchaseError},p),{},{status:r,productId:I,skuId:d,availabilityId:c,error:JSON.stringify(y)})),null===s||void 0===s||s(null!==y&&void 0!==y?y:new Error("Unknown purchase status"),e),null===t||void 0===t||t()}b.current=!0},onMessage:e=>{switch(v.info(e.data),e.type){case l.EEi.PageChange:r(e.data);break;case l.EEi.OpenUrl:null===d||void 0===d||d(e.data);break;default:v.error(`Unknown message type encountered: ${e.type}`)}}})),[d,v,u,t,s,o,r,n,p,i])})({onPageChange:R,onSuccess:T,handleOpenUrl:x,onCancel:L,onClose:M,onError:A}),G=(0,c.useMemo)((()=>({callerApplicationId:null!==v&&void 0!==v?v:X,campaignId:"CloudGaming.Web"})),[X,v]);return(0,c.useEffect)((()=>{if(o)return(0,U.MF)(w,a()({productId:o,skuId:d,availabilityId:r,type:p,scenario:u,source:X},t)),N.trackEvent(a()(a()(a()({name:S.b.PurchaseStarted},_),t),{},{productId:o,skuId:d,availabilityId:r,type:p,source:X})),null===Q||void 0===Q||Q(),()=>{(0,U.Jv)(w)};N.trackEvent(a()(a()({name:S.b.PurchaseError},_),{},{productId:"",status:l.Qo6.PurchaseError,error:"Missing productId"}))}),[]),(0,E.ED)((0,c.useCallback)((()=>(N.trackEvent(a()(a()({name:S.b.PurchaseCancelled},_),{},{productId:o,status:l.Qo6.Canceled})),null===L||void 0===L||L(),!0)),[L,o,_,N])),(0,s.jsx)(i.iX,{partnerId:l.QNR,children:P?(0,s.jsx)(l.bBK,{onMessage:D,onResult:H}):(0,s.jsx)(l.bU3,a()({skipPurchaseConfirmation:!1,version:l.hoQ.v2,onResult:H,onMessage:D,tracking:G,clientType:O,activateStoreExperiments:B},e))})})),T=(0,c.memo)((e=>{const{productId:r,onError:o,referringProductId:n}=e,[,l]=(e=>{const[,r]=(0,h.x)(e),o=(0,P.N)(),n=(0,c.useMemo)((()=>(0,t.lceTransform)(r,(e=>{var n;return r.type!==t.LCEType.Error&&e&&o?null===(n=e.offerings[o])||void 0===n?void 0:n.programs:[]}))),[r,o]);return(0,t.useLce)(n)})(n||r),[,i]=(0,p.sv)(v.CZ),b=(0,c.useMemo)((()=>l.type===t.LCEType.Error?(0,t.lceContent)([]):l),[l]),g=(0,c.useMemo)((()=>(0,t.lceTransform)((0,t.lceMerge)(b,i),(r=>{let[o,n]=r;return a()({productPrograms:null!==o&&void 0!==o?o:[],xgpuEntitlement:null!==n&&void 0!==n?n:void 0},e)}))),[b,e,i]),y=(0,c.useMemo)((()=>g.type===t.LCEType.Error?g.error:void 0),[g]);(0,c.useEffect)((()=>{y&&o&&o(y)}),[y,o]);const m=()=>(0,s.jsx)(d.AV,{});return(0,s.jsx)(u.LceRenderer,{data:g,renderContent:r=>{let{data:o}=r;return(0,s.jsx)(x,a()({productPrograms:o.productPrograms,xgpuEntitlement:o.xgpuEntitlement},e))},renderFetching:m,renderDefault:m})}))}}]);